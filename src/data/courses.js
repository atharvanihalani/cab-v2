import spring2026 from './courses_final.json';

const mockCourses = [
  {
    id: 1,
    code: "CSCI 1470",
    title: "Deep Learning",
    department: "CSCI",
    description: "Introduction to deep learning, covering neural networks, convolutional networks, recurrent networks, and transformers. Students will implement models from scratch and apply them to computer vision and natural language processing tasks.",
    instructor: "Chen Sun",
    time: "MWF 10:00-10:50",
    location: "CIT 368",
    format: "Lecture",
    size: 120,
    enrolled: 98,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.2,
    reviewCount: 47,
  },
  {
    id: 2,
    code: "PHIL 1640",
    title: "Ethics and Politics",
    department: "PHIL",
    description: "Examination of fundamental questions in political philosophy: What justifies the state? What are the limits of individual liberty? How should resources be distributed? Readings from Rawls, Nozick, and contemporary theorists.",
    instructor: "David Estlund",
    time: "TTh 1:00-2:20",
    location: "Smith-Buonanno 106",
    format: "Seminar",
    size: 25,
    enrolled: 24,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.7,
    reviewCount: 32,
  },
  {
    id: 3,
    code: "ECON 1110",
    title: "Intermediate Microeconomics",
    department: "ECON",
    description: "Theory of consumer and firm behavior, market equilibrium, welfare economics, and market failures. Mathematical treatment of economic models with applications to policy questions.",
    instructor: "Emily Oster",
    time: "MWF 11:00-11:50",
    location: "Salomon 101",
    format: "Lecture",
    size: 80,
    enrolled: 76,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.5,
    reviewCount: 89,
  },
  {
    id: 4,
    code: "POLS 1420",
    title: "Politics of the Developing World",
    department: "POLS",
    description: "Comparative analysis of political systems in developing countries. Topics include democratization, authoritarianism, ethnic conflict, and economic development. Case studies from Africa, Asia, and Latin America.",
    instructor: "Melani Cammett",
    time: "TTh 10:30-11:50",
    location: "Friedman 102",
    format: "Lecture",
    size: 45,
    enrolled: 38,
    level: 1000,
    modality: "hybrid",
    credit: "full",
    isIndependentStudy: false,
    designations: ["WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.3,
    reviewCount: 28,
  },
  {
    id: 5,
    code: "APMA 1650",
    title: "Statistical Inference I",
    department: "APMA",
    description: "Introduction to probability theory and statistical inference. Topics include random variables, distributions, estimation, hypothesis testing, and regression. Applications to data analysis.",
    instructor: "Kavita Ramanan",
    time: "MWF 2:00-2:50",
    location: "Barus & Holley 166",
    format: "Lecture",
    size: 100,
    enrolled: 87,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 3.9,
    reviewCount: 112,
  },
  {
    id: 6,
    code: "HIST 1230",
    title: "The American Civil War",
    department: "HIST",
    description: "The causes, course, and consequences of the American Civil War. Topics include slavery, sectionalism, military history, emancipation, and Reconstruction. Extensive use of primary sources.",
    instructor: "Michael Vorenberg",
    time: "MWF 1:00-1:50",
    location: "Wilson 102",
    format: "Lecture",
    size: 60,
    enrolled: 52,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.6,
    reviewCount: 41,
  },
  {
    id: 7,
    code: "VISA 1110",
    title: "Digital Art and Design",
    department: "VISA",
    description: "Introduction to digital tools for artistic expression. Students explore graphic design, digital imaging, and interactive media while developing their creative voice and technical skills.",
    instructor: "Wendy Chun",
    time: "W 3:00-5:50",
    location: "List Art Center 210",
    format: "Studio",
    size: 15,
    enrolled: 15,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.4,
    reviewCount: 19,
  },
  {
    id: 8,
    code: "NEUR 1020",
    title: "Principles of Neuroscience",
    department: "NEUR",
    description: "Survey of the nervous system from molecules to behavior. Topics include neural signaling, sensory systems, motor control, learning, memory, and neurological disorders.",
    instructor: "Diane Bhattacharjee",
    time: "TTh 2:30-3:50",
    location: "MacMillan 117",
    format: "Lecture",
    size: 90,
    enrolled: 82,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.1,
    reviewCount: 67,
  },
  {
    id: 9,
    code: "ENGN 1620",
    title: "Biomedical Engineering Design",
    department: "ENGN",
    description: "Team-based design projects addressing real clinical needs. Students work with physicians and patients to develop medical devices and technologies. Emphasis on human-centered design.",
    instructor: "Eric Darling",
    time: "MWF 10:00-10:50",
    location: "Barus & Holley 155",
    format: "Lecture",
    size: 35,
    enrolled: 31,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["COEX"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.8,
    reviewCount: 24,
  },
  {
    id: 10,
    code: "ANTH 1310",
    title: "Human Evolution",
    department: "ANTH",
    description: "The fossil and archaeological record of human evolution. Topics include primate origins, early hominins, the emergence of Homo sapiens, and the development of culture and technology.",
    instructor: "Jeremy DeSilva",
    time: "TTh 9:00-10:20",
    location: "Metcalf Auditorium",
    format: "Lecture",
    size: 55,
    enrolled: 48,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.9,
    reviewCount: 53,
  },
  {
    id: 11,
    code: "CSCI 1430",
    title: "Computer Vision",
    department: "CSCI",
    description: "Techniques for analyzing and understanding images and video. Topics include image formation, feature detection, recognition, segmentation, and 3D reconstruction.",
    instructor: "James Tompkin",
    time: "TTh 10:30-11:50",
    location: "CIT 241",
    format: "Lecture",
    size: 80,
    enrolled: 72,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.3,
    reviewCount: 38,
  },
  {
    id: 12,
    code: "SOC 1620",
    title: "Urban Sociology",
    department: "SOC",
    description: "Analysis of urban life, cities, and metropolitan areas. Topics include urbanization, inequality, segregation, gentrification, and urban policy. Field research component.",
    instructor: "Hilary Silver",
    time: "MWF 11:00-11:50",
    location: "Maxcy 104",
    format: "Seminar",
    size: 20,
    enrolled: 18,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["COEX", "WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.5,
    reviewCount: 22,
  },
  {
    id: 13,
    code: "MUSC 1230",
    title: "Music and Politics",
    department: "MUSC",
    description: "Exploration of how music intersects with political movements and social change. Case studies from civil rights, protest movements, nationalism, and propaganda.",
    instructor: "Kiri Miller",
    time: "TTh 1:00-2:20",
    location: "Orwig Music Hall",
    format: "Seminar",
    size: 18,
    enrolled: 16,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["DIAP"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.7,
    reviewCount: 15,
  },
  {
    id: 14,
    code: "ENVS 1510",
    title: "Climate Change and Society",
    department: "ENVS",
    description: "Scientific basis of climate change and its social, economic, and political dimensions. Topics include energy systems, policy options, environmental justice, and adaptation strategies.",
    instructor: "Leah VanWey",
    time: "MWF 1:00-1:50",
    location: "MacMillan 115",
    format: "Lecture",
    size: 65,
    enrolled: 58,
    level: 1000,
    modality: "hybrid",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.2,
    reviewCount: 34,
  },
  {
    id: 15,
    code: "COLT 1810",
    title: "Literature and Philosophy",
    department: "COLT",
    description: "Reading major works of literature alongside philosophical texts that illuminate them. Explores themes of truth, beauty, morality, and existence through fiction and philosophy.",
    instructor: "Thangam Ravindranathan",
    time: "TTh 2:30-3:50",
    location: "Sayles 104",
    format: "Seminar",
    size: 15,
    enrolled: 14,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.8,
    reviewCount: 18,
  },
  {
    id: 16,
    code: "CLPS 1490",
    title: "Judgment and Decision Making",
    department: "CLPS",
    description: "How people make judgments and decisions, and why they often deviate from rational models. Topics include heuristics, biases, risk perception, and behavioral economics.",
    instructor: "Amitai Shenhav",
    time: "MWF 10:00-10:50",
    location: "Metcalf Research 230",
    format: "Lecture",
    size: 70,
    enrolled: 64,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.4,
    reviewCount: 45,
  },
  {
    id: 17,
    code: "POLS 1140",
    title: "Political Philosophy",
    department: "POLS",
    description: "Introduction to the great texts of political philosophy from Plato to contemporary theorists. Questions of justice, liberty, equality, and the good life.",
    instructor: "Sharon Krause",
    time: "MWF 2:00-2:50",
    location: "Salomon 003",
    format: "Lecture",
    size: 50,
    enrolled: 43,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.6,
    reviewCount: 51,
  },
  {
    id: 18,
    code: "BIOL 1270",
    title: "Ecology and Evolution",
    department: "BIOL",
    description: "Principles of ecology and evolutionary biology. Topics include natural selection, adaptation, population dynamics, community ecology, and conservation biology.",
    instructor: "Dov Sax",
    time: "TTh 9:00-10:20",
    location: "Bio-Med Center 291",
    format: "Lecture",
    size: 85,
    enrolled: 79,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.0,
    reviewCount: 72,
  },
  {
    id: 19,
    code: "ECON 1630",
    title: "Econometrics",
    department: "ECON",
    description: "Statistical methods for analyzing economic data. Topics include regression analysis, instrumental variables, panel data, and causal inference. Hands-on analysis using real datasets.",
    instructor: "Jesse Shapiro",
    time: "MWF 11:00-11:50",
    location: "Robinson 301",
    format: "Lecture",
    size: 60,
    enrolled: 55,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.1,
    reviewCount: 63,
  },
  {
    id: 20,
    code: "TAPS 1230",
    title: "Acting Fundamentals",
    department: "TAPS",
    description: "Introduction to the craft of acting. Physical and vocal training, text analysis, and scene work. Students develop their instrument and explore various performance techniques.",
    instructor: "Lowry Marshall",
    time: "TTh 3:00-5:20",
    location: "Leeds Theatre",
    format: "Studio",
    size: 12,
    enrolled: 12,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: [],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.9,
    reviewCount: 14,
  },
  {
    id: 21,
    code: "CSCI 1970",
    title: "Independent Study in Computer Science",
    department: "CSCI",
    description: "Independent research project under faculty supervision. Students propose and execute a research project in an area of computer science.",
    instructor: "Staff",
    time: "TBA",
    location: "TBA",
    format: "Independent Study",
    size: 1,
    enrolled: 1,
    level: 1000,
    modality: "in-person",
    credit: "half",
    isIndependentStudy: true,
    designations: [],
    syllabusUrl: null,
    criticalReviewUrl: null,
    rating: null,
    reviewCount: 0,
  },
  {
    id: 22,
    code: "SOC 1870",
    title: "Community-Based Research Methods",
    department: "SOC",
    description: "Students partner with local community organizations to conduct research addressing real community needs. Emphasis on ethical research practices and community engagement.",
    instructor: "Michael Kennedy",
    time: "W 3:00-5:30",
    location: "Maxcy 105",
    format: "Seminar",
    size: 12,
    enrolled: 10,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["COEX", "WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.6,
    reviewCount: 11,
  },
  {
    id: 23,
    code: "ENGL 1010",
    title: "Introduction to Creative Writing",
    department: "ENGL",
    description: "Workshop-based introduction to fiction and poetry writing. Students read contemporary works and develop their own creative voice through regular writing exercises.",
    instructor: "Joanna Howard",
    time: "TTh 10:30-11:50",
    location: "Online",
    format: "Seminar",
    size: 15,
    enrolled: 13,
    level: 1000,
    modality: "online",
    credit: "full",
    isIndependentStudy: false,
    designations: ["WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.5,
    reviewCount: 27,
  },
  {
    id: 24,
    code: "AFRI 1060",
    title: "Race and Public Policy",
    department: "AFRI",
    description: "Examination of how race shapes public policy in America. Topics include education, housing, criminal justice, and healthcare disparities.",
    instructor: "Tricia Rose",
    time: "MWF 1:00-1:50",
    location: "Salomon 001",
    format: "Lecture",
    size: 45,
    enrolled: 42,
    level: 1000,
    modality: "in-person",
    credit: "full",
    isIndependentStudy: false,
    designations: ["DIAP", "WRIT"],
    syllabusUrl: "https://coursetools.brown.edu",
    criticalReviewUrl: "https://thecriticalreview.org",
    rating: 4.7,
    reviewCount: 36,
  },
];

const DAY_ORDER = ['M', 'T', 'W', 'Th', 'F', 'Sa', 'Su'];

// Fix scraped times where colon shifted right: "90:0" → "9:00", "83:0" → "8:30"
function fixTime(t) {
  if (!t) return t;
  const h = parseInt(t.split(':')[0], 10);
  if (h > 23) {
    const digits = t.replace(':', '');
    return digits[0] + ':' + digits.slice(1).padEnd(2, '0');
  }
  return t;
}

function formatTimeRange(startTime, endTime) {
  if (!startTime || !endTime) return 'TBA';
  startTime = fixTime(startTime);
  endTime = fixTime(endTime);
  const toDisplay = (t) => {
    const [hStr, mStr] = t.split(':');
    let h = parseInt(hStr, 10);
    const m = parseInt(mStr, 10);
    const suffix = h >= 12 ? 'p' : 'a';
    h = h % 12;
    if (h === 0) h = 12;
    return `${h}:${m.toString().padStart(2, '0')}${suffix}`;
  };
  return `${toDisplay(startTime)}-${toDisplay(endTime)}`;
}

function formatMeetingTimes(meetingTimes) {
  if (!Array.isArray(meetingTimes) || meetingTimes.length === 0) return 'TBA';

  // Group entries by time range so "T 2:30-3:50" + "Th 2:30-3:50" → "TTh 2:30-3:50"
  const byTime = {};
  meetingTimes.forEach((mt) => {
    if (!mt || mt.tba) return;
    const timeKey = formatTimeRange(mt.start_time, mt.end_time);
    // Handle both singular `day` (new data) and `days` array (old data)
    const days = mt.day ? [mt.day] : (Array.isArray(mt.days) ? mt.days : []);
    if (!byTime[timeKey]) byTime[timeKey] = new Set();
    days.forEach((d) => byTime[timeKey].add(d));
  });

  const entries = Object.entries(byTime);
  if (entries.length === 0) return 'TBA';

  return entries
    .map(([timeRange, daySet]) => {
      const days = [...daySet].sort((a, b) => DAY_ORDER.indexOf(a) - DAY_ORDER.indexOf(b));
      return `${days.join('')} ${timeRange}`.trim();
    })
    .join(', ');
}

function deriveDepartment(code) {
  if (!code) return 'GEN';
  const match = code.match(/^[A-Z]+/);
  return match ? match[0] : 'GEN';
}

function deriveLevel(code) {
  const match = code.match(/(\d{3,4})/);
  if (!match) return 0;
  const num = parseInt(match[1], 10);
  return Number.isNaN(num) ? 0 : num;
}

const spring2026Courses = Array.isArray(spring2026)
  ? spring2026.map((course, index) => {
      const creditHours = course.credit_hours;
      const credit = creditHours === '1' || creditHours === '2' ? 'full' : 'half';
      return {
        id: course.id || index + 1,
        code: course.code || `COURSE ${index + 1}`,
        title: course.title || 'Untitled Course',
        department: deriveDepartment(course.code),
        description: course.description || '',
        instructor: course.instructor || 'TBA',
        time: formatMeetingTimes(course.meeting_times),
        location: 'TBA',
        format: course.format || 'Lecture',
        size: course.max_enrollment ?? course.current_enrollment ?? null,
        enrolled: course.current_enrollment || null,
        level: deriveLevel(course.code),
        modality: 'in-person',
        credit,
        isIndependentStudy: false,
        designations: course.designations || [],
        syllabusUrl: null,
        criticalReviewUrl: course.critical_review_url || null,
        rating: null,
        reviewCount: null,
      };
    })
  : [];

export const courses = spring2026Courses.length > 0 ? spring2026Courses : mockCourses;

// Course designations reference:
// WRIT - Writing designated (writing intensive)
// COEX - Community-based learning / Engaged scholarship
// DIAP - Diversity and inclusion / Anti-racism
